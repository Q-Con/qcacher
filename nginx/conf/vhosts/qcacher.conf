# qcacher load balancer


# We use server_name as part of the cache key so ensure we use a descriptive unique
# as the first value + '_' (invalid hostname) to ensure catch all default behaviour.

# steam
server {
    listen 80;
    server_name qcacher-steam cs.steampowered.com *.cs.steampowered.com
                content1.steampowered.com content2.steampowered.com
                content3.steampowered.com content4.steampowered.com
                content5.steampowered.com content6.steampowered.com
                content7.steampowered.com content8.steampowered.com
                *.hsar.steampowered.com.edgesuite.net
                *.akamai.steamstatic.com content-origin.steampowered.com
                client-download.steampowered.com;
    access_log /var/log/nginx/qcacher-steam-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-steam-error.log;
    include qcacher/node-steam;
}

# riot
server {
    listen 80;
    server_name qcacher-riot l3cdn.riotgames.com;
    access_log /var/log/nginx/qcacher-riot-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-riot-error.log;
    include qcacher/node-default;
}

# blizzard
server {
    listen 80;
    server_name qcacher-blizzard dist.blizzard.com.edgesuite.net
                llnw.blizzard.com dist.blizzard.com blizzard.vo.llnwd.net
                blzddist1-a.akamaihd.net blzddist1-b.akamaihd.net
                blzddist2-a.akamaihd.net blzddist2-b.akamaihd.net
                blzddist3-a.akamaihd.net blzddist3-b.akamaihd.net;
    access_log /var/log/nginx/qcacher-blizzard-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-blizzard-error.log;
    include qcacher/node-blizzard;
}

# hirez
server {
    listen 80;
    server_name qcacher-hirez hirez.http.internapcdn.net;

    # We don't cache the main download as thats on *.hwcdn.net which containts lots
    # more than just hirez e.g. store.steampowered.com which is https.
    include qcacher/node-default;
}

# origin
server {
    listen 80;
    server_name qcacher-origin akamai.cdn.ea.com lvlt.cdn.ea.com
                origin-a.akamaihd.net origin-b.akamaihd.net;
    access_log /var/log/nginx/qcacher-origin-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-origin-error.log;
    include qcacher/node-origin;
}

# sony
server {
    listen 80;
    server_name qcacher-sony pls.patch.station.sony.com;
    access_log /var/log/nginx/qcacher-sony-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-sony-error.log;
    include qcacher/node-default;
}

# turbine
server {
    listen 80;
    server_name qcacher-turbine download.ic.akamai.turbine.com
                launcher.infinitecrisis.com;
    access_log /var/log/nginx/qcacher-turbine-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-turbine-error.log;
    include qcacher/node-default;
}

# microsoft
server {
    listen 80;
    server_name qcacher-microsoft *.download.windowsupdate.com
                download.windowsupdate.com dlassets.xboxlive.com
                *.xboxone.loris.llnwd.net xboxone.vo.llnwd.net
                images-eds.xboxlive.com xbox-mbr.xboxlive.com;
    access_log /var/log/nginx/qcacher-microsoft-access.log main buffer=128k flush=1m;
    error_log /var/log/nginx/qcacher-microsoft-error.log;
    include qcacher/node-microsoft;
}

# status
server {
    listen 80 default;
    server_name qcacher _;
    access_log /var/log/nginx/qcacher-status-access.log;
    error_log /var/log/nginx/qcacher-status-error.log;
    location = / {
        stub_status on;
    }
}
